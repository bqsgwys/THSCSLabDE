# <center>第三章：C，C++</center>

# <center>一、绪论</center>
## 1.这是啥？
> C是一种通用的编程语言，广泛用于系统软件与应用软件的开发。<br>
> C++是一种使用广泛的计算机程序设计语言。它是一种通用程序设计语言，支持多重编程模式，例如过程化程序设计、数据抽象、面向对象程序设计、泛型程序设计和设计模式等。

说白了，就是C/C++包含了大部分的系统层面上的应用、库和程序实例。也就是说你们装的大部分“轮子”都是被C/C++编写的
## 2.我们要干啥
事实上，我并不认为学习C/C++语言本身是必要的，但是重要的是学习如何编译已经存在的源代码，而这些源代码将会被用在各种语言的库，实例和应用上。这节课你将学到
- 如何用G++(GCC)/MSVC编译程序
- 如何利用参数辅助编译
- 会看简单的报错

# <center>二、开始工作</center>
## 1.安装环境和步骤介绍
在上节课的过程中，我们已经安装了g++和gcc，这样的话就不需要安装其他的了。

#### gcc/g++在执行编译工作的时候，总共需要4步：
1. 预处理,生成.i的文件  
    >预处理器cpp
2. 将预处理后的文件不转换成汇编语言,生成文件.s  
    >编译器egcs
3. 有汇编变为目标代码(机器代码)生成.o的文件
    >汇编器as
4. 连接目标代码,生成可执行程序
    >连接器ld

以上如果有不太明白且好奇的，可以自行维基，完全讲完是大学的一门专业课：编译原理，我就不展开了（我也不是很了解&#x1F602;）。

## 2.编译初体验
朋友们，还记得Hello,World!么？这是你们第一个程序吧。如果你们不会c++也没有关系，我贴心地为你们准备了[源代码](./3/helloworld.cpp)。我们使用g++程序进行编译，事实上msvc也是一样的。
```
$ g++ helloworld.cpp
```
然后就会在当前目录下生成一个叫做`a.out`的可执行文件。直接使用`./a.out`运行它，然后就会看到Hello,World!了
## 3.编译多文件
事实上，绝大多数的C/C++程序或库是多文件的，也就是说有多个.cpp文件，那么我们如何编译呢？<br>
我们来看下这个例子，[文件夹](./3/workspace/)结构如下所示
```
workspace
|- func.cpp
|- main.cpp
```
若我们单独编译这两个文件有以下错误
```
func.cpp:
    Scrt1.o: In function `_start':
    (.text+0x20): undefined reference to `main'
    collect2: error: ld returned 1 exit status
    
main.cpp:
     In function `main':
    main.cpp: undefined reference to `func()'
    collect2: error: ld returned 1 exit status
```
一般来讲我们有两种办法：<br>
第一种直接`g++ func.cpp main.cpp`就和原来一样<br>
第二种先转化为机器语言再链接，代码如下
```
$ g++ -c func.cpp
$ g++ -c main.cpp
$ g++ func.o main.o
```
其中前两行就是将源代码变为机器代码，最后链接。<br>
这样做的好处就是不同的源代码可以有不同的编译参数，关于编译参数我们会在下一点提到。
## 4.编译选项（命令参数）
### a) 总体选项
- -E<br>
    只预处理,不生成文件,直接输出到标准输出（命令行），如果你需要文件，可以重定向
    > 指令`g++ -E helloworld.cpp > long.cpp`可以生成一个105,712行的一个cpp文件（Linux下）...
- -S<br> 
    只预处理和编译，就是指把文件编译成为汇编代码。     
    > 指令`g++ -S helloworld.cpp`
    将生成.s的汇编代码，你可以用文本编辑器察看
- -c<br>
    只预处理,编译,和汇编,也就是他只把程序做成obj文件 
    > 指令`g++ -c helloworld.cpp`将生成.o的obj文件 

### b) 错误与告警选项
- -W{warning}<br>
    常用的`{warning}`有：
    - `-Wall`(包含绝大多数Warning)
    - `-Wextra`(包含`Wall`外的一些Warning)
    - 其他可以用man指令查看或[这个网站](https://linux.die.net/man/1/g++)

### c) 优化选项
- -O0<br>
    > 这个等级关闭所有优化选项，这样就不会优化代码，一般不推荐。
- -O1<br>
    > 这是最基本的优化等级。编译器会在不花费太多编译时间的同时试图生成更快更小的代码。这些优化是非常基础的，不特别推荐。 
- -O2<br>
    > -O1的进阶。这是推荐的优化等级。-设置了-O2后，编译器会试图提高代码性能而不会增大体积和大量占用的编译时间。
- -Os<br>
    > 这个等级用来优化代码尺寸。其中启用了-O2中不会增加磁盘空间占用的代码生成选项，但可能会出现一些不可预知的问题，故不推荐的。
- -O3<br>
    > 这是最高最危险的优化等级。用这个选项会延长编译代码的时间。用-O3来编译所有的软件包将产生更大体积更耗内存的二进制文件，大大增加编译失败的机会或不可预知的程序行为，所以不推荐。

### c) 其他选项
- -o [filename]<br>
制定目标名称,缺省的时候,g++译出来的文件是a.out
>命令`g++ -o hello(.exe) helloworld.cpp`就是输出叫hello（.exe windows需要exe，Linux不需要）的可执行文件而不是a.out。

>命令`g++ -o hello.asm -S helloworld.cpp ` 就是输出叫hello.asm的汇编文件而不是helloworld.s。 

***朋友们，如果你们想更多的了解g++/gcc可以使用man指令***
## 5. 编译错误
如果你是从网上下载的源代码，一般不会出错，若出错了可去Issue区查找问题。
如果你是自己编写的代码，可以从错误信息中得出是第几行的问题，从而修改代码。

## 6. 头文件与库文件
### a) 二者的区别
头文件中有函数的申明，库文件实现函数的定义。比如，`printf`函数。使用时应包括`stdio.h`，打开`stdio.h`你只能看到，`printf`这个函数的申明,却看不到`printf`具体是怎么实现的，而函数的实现在相应的库中。所以,如果在代码里要用到这些函数那么就要包含头文件,编译的时候才能知道这些函数的原形;  
### b) 静态库和动态库
如果你需要用一个库，连接器就会把函数的实现**代码**(静态库)连接到你的程序或者将你的函数调用连接到相应的DLL的对应**函数**(动态库)
#### 静态库
静态库是你在编译链接的时候需要加到编译命令里的代码库。一般以`.a`作为扩展名，处在源代码文件夹附近。
#### 动态库
在编译程序时，使用动态链接库和静态库是一致的，但动态库文件需要在`/lib`(Linux)下或者`%system32%`(Windows)或者程序目录下。
#### 动态库优势
更新动态库时只需要更新动态库文件不需要重新编译，而静态库只能重新编译

# <center>三、练习</center>
1. 编一个小程序，有趣的库，编译一下静态库，动态库，感受一下区别
2. 用-On加速一个比较复杂的代码，感受一下运行速度的差异。